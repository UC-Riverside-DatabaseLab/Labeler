{% extends "base_site.html" %}
{% load static %}
{% load check_prerequisite %}

{% block extrastyle %}
	<link rel="stylesheet" type="text/css" href="{% static 'css/index.css' %}">
{% endblock extrastyle %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'home' %}">Home </a>

&rsaquo;	
<a href="{% url 'task:task_evaluation_list' %}">Task Evaluation List </a>
&rsaquo; Task Evaluation Detail
</div>
{% endblock breadcrumbs %}



{% block content %}
<!--div class="container-fluid"-->
	<!--div class="col-sm-12"-->
		<h1>Kappa Evaluation for {{task}} </h1><h2><a href={{tablefile}} download>[download table as a file]</a></h2>
		<table class="table table-striped">
			<!--thead>
				<tr class="table-head">
					<th>Labeler Pairs</th>
					<th>Kappa</th>
				</tr>
			</thead-->
			<tbody>
			{% for row in head %}
			<thead>
			
			<tr><th></th>
				{% for col in row %}
					{% if col != "(List continues...)" %}
	                                      <th>{{ col }}</th>
        	                        {% else %}
                	                       <th><a href="" >(...)</a></th>
                        	         {% endif %}

									
														
								
				
				{% endfor %}
			</tr>
			<thead>
			{% endfor %}
			{% for row in head %} 
			<tr>
				{% for col in row %}
				<tr>
					 {% if col != "(List continues...)" %}
                                              <th>{{ col }}</th>
					 {% else %}
						<th><a href={{tablefile}} download>[See full list]</a></th>
					 {% endif %}
					
					{% for rowp in kappa.0 %}                               		 		                               													
								<!--td></td-->
						
							{% if col in rowp %} 							
								<td>{{ rowp.2 }}</td>
							{% endif %}  
					
					{% endfor %}			
				</tr>
				{% endfor %}				
			</tr>
			{% endfor %}
			
			</tbody>
		</table>
		<br/>
		<h1>Krippendorff's alpha: &nbsp {{ alpha }}</h1>
		<br/>
		<!--h1>"{{ task }}" Evaluation</h1-->
		<h1>Evaluation Details for {{task}}</h1><h2><a href={{tablefile1}}>[download table as a file]</a></h2>
		<table class="table table-striped">
			<thead>
				<tr class="table-head">
					<th>Post</th>
					{% for coder_email in coder_email_list %}
						{% if coder_email != "(List continues...)" %}
							<th>{{ coder_email }}</th>
						{% else %}
							<th><a href={{tablefile1}} download >[See Full List]</a></th>
						{% endif %}
						
					{% endfor %}
					<th>Majority Vote</th>
				</tr>
			</thead>
			<tbody>
				{% for row in array %}
				<tr>
				{% if forloop.counter > 5 %}
					<tr><td>...</td></tr>	 									
				{% else %}
									
					{% for col in row %}
						<td>{{ col }}</td>
					{% endfor %}
				</tr>
				{% endif %}
				
				{% endfor %}

				
			</tbody>
			
		</table>
		<div>
    <input type="button" id="button_1" name="merge" value="Merge Majority Vote to database">  
		</div>
	</div>

</div>
<script>
$(document).ready(function() {
  $("#button_1").click(function(e) {

    e.preventDefault();
    var col_name = prompt("Please type in the field name(MYSQL) or dataset name(AsterixDB) you want to store the majority vote in:", "");
    if(confirm('Begin to merge majority into original database. Click OK to continue.'))
    {
    $.ajax({
      type: "POST",
      url: "/task/merge_database/",
      data: {
        id:  "{{task_id}}",
        path: "{{tablefile1}}",
        name: col_name
      },
      success: function(result) {
        alert('Transaction Complete');
      },
      error: function(result) {
        alert('Connection error or duplicate field name');
      }
    });
  }
  });
});
</script>


{% endblock content %}
